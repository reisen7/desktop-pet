/* === 全局重置 === */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    user-select: none;
}

body {
    background: transparent;
    overflow: hidden;
    cursor: default;
    font-family: 'Microsoft YaHei', sans-serif;
    /* 允许拖拽整个窗口，但在特定元素上禁用 */
    -webkit-app-region: no-drag; 
}

/* === 核心容器 === */
.pet-container {
    width: 100%;
    height: 100vh; /* 占满整个窗口 */
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* === 宠物角色 === */
.pet-character {
    /* 基础尺寸，会被具体心情覆盖 */
    width: 120px;
    height: 120px;
    background-repeat: no-repeat;
    background-position: 0 0;
    cursor: pointer;
    position: relative;
    
    /* 允许拖拽 - 改为由 JS 控制，否则无法响应点击事件 */
    /* -webkit-app-region: drag; */
    -webkit-app-region: no-drag;
    
    /* 优化渲染 */
    image-rendering: -webkit-optimize-contrast;
    will-change: transform, background-position;
    
    /* 确保宠物在最上层，不容易被遮挡 */
    z-index: 100; 
    
    /* 基础过渡 */
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 0.3s ease;
}

/* --- 心情模式与动画 --- */

/* 1. 开心 (Happy) - 对应 stand.jpg (680x68, 10帧) */
.pet-character.mood-happy {
    width: 68px;
    height: 68px;
    background-image: url('assets/stand.jpg');
    background-size: 680px 68px; /* 总宽度 x 高度 */
    border-radius: 0; /* 像素画通常不需要圆角 */
    box-shadow: none;
    border: none;
    /* 10帧动画，1秒播完，steps(10) */
    animation: anim-happy 1s steps(10) infinite;
}

@keyframes anim-happy {
    from { background-position-x: 0; }
    to { background-position-x: -680px; }
}

/* 2. 打喷嚏 (Sneeze) - 对应 attack.jpg (720x67, 8帧) */
.pet-character.mood-sneeze {
    width: 90px;
    height: 67px;
    background-image: url('assets/attack.jpg');
    background-size: 720px 67px;
    border-radius: 0;
    box-shadow: none;
    border: none;
    /* 8帧动画，0.8秒播完 */
    animation: anim-sneeze 0.8s steps(8) infinite;
}

@keyframes anim-sneeze {
    from { background-position-x: 0; }
    to { background-position-x: -720px; }
}

/* 3. 困倦 (Sleepy) - 对应 sleep-tired.jpg (162x34, 2帧) */
.pet-character.mood-sleepy {
    width: 81px;
    height: 34px;
    background-image: url('assets/sleep-tired.jpg');
    background-size: 162px 34px;
    border-radius: 0;
    box-shadow: none;
    border: none;
    /* 2帧动画，2秒播完(慢一点) */
    animation: anim-sleepy 2s steps(2) infinite;
}

@keyframes anim-sleepy {
    from { background-position-x: 0; }
    to { background-position-x: -162px; }
}

/* 4. 害羞/拒绝 (Shy) - 对应 dont-torch-me.jpg (120x60, 2帧) */
.pet-character.mood-shy {
    width: 60px;
    height: 60px;
    background-image: url('assets/dont-torch-me.jpg');
    background-size: 120px 60px;
    border-radius: 0;
    box-shadow: none;
    border: none;
    /* 2帧动画 */
    animation: anim-shy 1s steps(2) infinite;
}

@keyframes anim-shy {
    from { background-position-x: 0; }
    to { background-position-x: -120px; }
}

/* 5. 奔跑 (Running) - 8帧 */
.pet-character.running {
    width: 60px;
    height: 52px;
    background-image: url('assets/miku-walk.jpg');
    background-size: 480px 52px; /* 800% 宽度 */
    border-radius: 0;
    box-shadow: none;
    border: none;
    animation: anim-run 0.8s steps(8) infinite, anim-move-screen 5s linear infinite;
}

@keyframes anim-run {
    from { background-position-x: 0; }
    to { background-position-x: -480px; }
}

/* === 行为动画 (覆盖基础动画) === */
.bounce { animation: kf-bounce 0.6s cubic-bezier(0.280, 0.840, 0.420, 1); }
.shake  { animation: kf-shake 0.5s ease-in-out; }
.spin   { animation: kf-spin 1s ease-in-out; }
.jump   { animation: kf-jump 0.8s ease-in-out; }
.pulse  { animation: kf-pulse 0.5s ease-in-out; }
.float  { animation: kf-float 3s ease-in-out infinite; }
/* 对于叠加动画，需要注意不能冲突。这里简单处理，行为动画优先级高 */

@keyframes kf-bounce {
    0%, 100% { transform: translateY(0) scale(1); }
    30% { transform: translateY(-20px) scale(1.1, 0.9); }
    50% { transform: translateY(0) scale(0.9, 1.1); }
    70% { transform: translateY(-10px) scale(1.05, 0.95); }
}
@keyframes kf-shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-5px) rotate(-5deg); }
    40%, 80% { transform: translateX(5px) rotate(5deg); }
}
@keyframes kf-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
@keyframes kf-jump {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-40px); }
}
@keyframes kf-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); filter: brightness(1.2); }
    100% { transform: scale(1); }
}
@keyframes kf-float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

/* === UI 组件 === */

/* 对话气泡 */
.speech-bubble {
    position: absolute;
    /* 回到宠物上方的经典位置 */
    bottom: 100%; 
    left: 50%;
    /* 水平居中，向上偏移 */
    transform: translateX(-50%) translateY(-10px); 
    background: rgba(255, 255, 255, 0.95);
    color: #333;
    padding: 6px 12px;
    border-radius: 12px;
    font-size: 13px;
    line-height: 1.3;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border: 1px solid #ffb7b2;
    z-index: 1000;
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none;
    min-width: 80px;
    max-width: 1500px; /* 进一步增加宽度 */
    text-align: center;
    word-break: keep-all; /* 不断词 */
    white-space: nowrap; /* 强制单行，不换行 */
}

/* 气泡的小三角 */
.speech-bubble::after {
    content: '';
    position: absolute;
    top: 100%; /* 在气泡底部 */
    left: 50%;
    transform: translateX(-50%);
    border-width: 6px 6px 0;
    border-style: solid;
    border-color: #ffb7b2 transparent transparent transparent;
}

/* 好感度悬浮窗 - 移到底部 */
.affection-display {
    position: absolute; /* 改为 absolute，相对于 pet-container */
    bottom: 10px; /* 改为底部 */
    left: 50%;
    transform: translateX(-50%); /* 水平居中 */
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 20px;
    padding: 5px 10px;
    color: white;
    font-size: 12px;
    display: flex;
    flex-direction: column;
    gap: 3px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: transform 0.2s;
    cursor: default;
    -webkit-app-region: no-drag;
    z-index: 1500;
    white-space: nowrap; /* 防止换行 */
}
.affection-display:hover {
    transform: scale(1.05);
    background: rgba(255, 255, 255, 0.3);
}
.affection-bar {
    width: 100px;
    height: 6px;
    background: rgba(0,0,0,0.2);
    border-radius: 3px;
    overflow: hidden;
}
.affection-fill {
    height: 100%;
    width: 50%;
    background: linear-gradient(90deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
    transition: width 0.5s ease;
}
.affection-info {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* 对话模式下，宠物上移 */
.pet-character.dialog-active {
    transform: translateY(-80px) scale(1) !important;
}

/* 隐藏好感度条 */
.affection-display.hidden {
    opacity: 0;
    pointer-events: none;
}

/* Galgame 对话框 */
.galgame-dialog {
    position: absolute;
    bottom: 10px; /* 稍微靠下一点 */
    left: 50%;
    transform: translateX(-50%);
    width: 260px; /* 稍微窄一点，适应窗口 */
    background: rgba(255, 255, 255, 0.98);
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.2);
    z-index: 2000;
    display: none;
    border: 2px solid #ffb7b2;
    -webkit-app-region: no-drag;
    transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);
    text-align: left; /* 文本左对齐 */
}

.dialog-text {
    font-size: 13px;
    line-height: 1.6;
    margin-bottom: 15px;
    color: #444; /* 改为深灰色，看清文字 */
    font-weight: 500;
}
.choice-button {
    background: #f9f9f9; /* 浅灰背景 */
    border: 1px solid #e0e0e0;
    padding: 10px 12px;
    border-radius: 8px;
    margin-bottom: 8px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    color: #555; /* 深色文字 */
    font-weight: 500;
}
.choice-button:hover {
    background: #fff5f5;
    border-color: #ffb7b2;
    color: #ff6b6b;
    transform: translateX(3px);
}

/* 右键菜单 - 紧凑版 */
.context-menu {
    position: fixed;
    background: rgba(255, 255, 255, 0.98); /* 不透明一点，看清文字 */
    backdrop-filter: blur(10px);
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    padding: 4px;
    min-width: 100px;
    z-index: 3000;
    display: none;
    -webkit-app-region: no-drag;
    transform-origin: top left;
    border: 1px solid #eee;
}
.menu-item {
    padding: 6px 10px; /* 减小内边距 */
    border-radius: 4px;
    font-size: 12px; /* 减小字号 */
    color: #444;
    cursor: pointer;
    transition: background 0.1s;
    display: flex;
    align-items: center;
    gap: 5px;
}
.menu-item:hover {
    background: #fff0f0;
    color: #ff6b6b;
}

/* 成就通知 */
.achievement-notification {
    position: fixed;
    top: 60px;
    right: -200px; /* 初始在屏幕外 */
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    padding: 12px 15px;
    border-radius: 10px 0 0 10px;
    color: white;
    box-shadow: -5px 5px 15px rgba(0,0,0,0.2);
    z-index: 3000;
    animation: slide-in 0.5s forwards, slide-out 0.5s 3.5s forwards;
}
.achievement-title { font-weight: bold; font-size: 14px; }
.achievement-desc { font-size: 11px; opacity: 0.9; }

@keyframes slide-in { to { right: 0; } }
@keyframes slide-out { to { right: -200px; } }
